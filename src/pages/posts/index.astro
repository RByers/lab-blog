---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('posts');
const years = [...new Set(allPosts.map((post) => post.data.date.getFullYear()))].sort((a, b) => b - a);

// Count posts per year
const postsByYear = years.map(year => {
    const count = allPosts.filter(p => p.data.date.getFullYear() === year).length;
    return { year, count };
});
---

<BaseLayout title="Archive">
  <p>Historical log data from the lab.</p>
  
  <div class="year-list">
    {postsByYear.map(({ year, count }) => (
      <div class="year-item">
        <a href={`/posts/${year}`}>{year}</a>
        <span class="count">({count} posts)</span>
      </div>
    ))}
  </div>

  {allPosts.length === 0 && <p>No archives found (yet).</p>}

  <style>
      .year-item {
          font-size: 1.5rem;
          margin-bottom: 1rem;
      }
      .count {
          font-size: 1rem;
          color: #666;
          margin-left: 0.5rem;
      }
  </style>
</BaseLayout>
