---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const allPosts = await getCollection("posts");

// Extract year from slug (structure: year/filename)
const years = [
  ...new Set(
    allPosts.map((post) => {
      const parts = post.slug.split("/");
      return parts.length > 1 ? parseInt(parts[0]) : null;
    }),
  ),
]
  .filter(Boolean)
  .sort((a, b) => b - a);

// Count posts per year
const postsByYear = years.map((year) => {
  const count = allPosts.filter((p) => p.slug.startsWith(`${year}/`)).length;
  return { year, count };
});
---

<BaseLayout title="Posts">
  <p>Archive of my old posts from X/Twitter @RickByersLab. For current social media, follow me on <a href="https://bsky.app/profile/lab.rbyers.ca">BlueSky</a></p>

  <div class="year-list">
    {
      postsByYear.map(({ year, count }) => (
        <div class="year-item">
          <a href={`/posts/${year}`}>{year}</a>
          <span class="count">({count} posts)</span>
        </div>
      ))
    }
  </div>

  {allPosts.length === 0 && <p>No posts found (yet).</p>}

  <style>
    .year-item {
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }
    .count {
      font-size: 1rem;
      color: #666;
      margin-left: 0.5rem;
    }
  </style>
</BaseLayout>
